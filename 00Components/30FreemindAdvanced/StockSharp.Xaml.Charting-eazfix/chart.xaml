<l1lil:Chart xmlns:l1lil="clr-namespace:StockSharp.Xaml.Charting"
             xmlns:s="clr-namespace:-"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lll="clr-namespace:Ecng.Xaml;assembly=StockSharp.Xaml"
             xmlns:l1ilills="clr-namespace:DevExpress.Xpf.Core;assembly=DevExpress.Xpf.Core.v22.1"
             xmlns:l1i11ii111="clr-namespace:StockSharp.Xaml;assembly=StockSharp.Xaml"
             xmlns:s="clr-namespace:Ecng.Xaml.Converters;assembly=StockSharp.Xaml"
             xmlns:li11l="clr-namespace:DevExpress.Xpf.Bars;assembly=DevExpress.Xpf.Core.v22.1"
             s:ThemeManager.Theme="{Binding SelectedTheme}">
  <FrameworkElement.Resources>
    <Style x:Key="Grpstyle"
           TargetType="{x:Type s:UltrachartGroupPane}">
      <Setter Property="s:UltrachartGroupPane.HeaderTemplate">
        <Setter.Value>
          <DataTemplate DataType="charting:ItemPane">
            <Grid VerticalAlignment="Center" Background="{x:Null}">
              <lll:EditableTextBlock MinWidth="20" HorizontalAlignment="Left" Margin="5,2,0,0" VerticalAlignment="Top"
                                     Text="{Binding PaneViewModel.Title, Mode=TwoWay}"/>
              <StackPanel Background="Transparent" HorizontalAlignment="Right" Margin="2,2" Orientation="Vertical"
                          VerticalAlignment="Center">
                <l1ilills:SimpleButton Background="Transparent" HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                         Command="{Binding ChangeOrientationCommand}">
                  <StackPanel>
                    <Image Width="12" Source="{l1i11ii111:ThemedIcons Pin}"
                           Visibility="{Binding ConverterParameter=inverse, Path=IsTabbed, Converter={s:BooleanToVisibilityConverter}}"/>
                    <Image Width="12" Source="{l1i11ii111:ThemedIcons Pinned}"
                           Visibility="{Binding Path=IsTabbed, Converter={s:BooleanToVisibilityConverter}}"/>
                  </StackPanel>
                </l1ilills:SimpleButton>
                <l1ilills:SimpleButton Background="Transparent" HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                         CommandParameter="{Binding PaneViewModel}" Command="{Binding PaneViewModel.ClosePaneCommand}"
                                         ToolTip="{l1i11ii111:Localization Close}">
                  <Image Width="12" Source="{l1i11ii111:ThemedIcons Remove2}"/>
                </l1ilills:SimpleButton>
              </StackPanel>
            </Grid>
          </DataTemplate>
        </Setter.Value>
      </Setter>
      <Setter Property="Control.Template">
        <Setter.Value>
          <ControlTemplate TargetType="{x:Type s:UltrachartGroupPane}">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition/>
              </Grid.RowDefinitions>
              <Thumb x:Name="PART_TopSplitter" BorderBrush="#77999999" BorderThickness="0,1"
                     Background="#33999999" Cursor="SizeNS" HorizontalAlignment="Stretch" Height="5"/>
              <ContentPresenter x:Name="PART_ContentHost" Content="{TemplateBinding ContentControl.Content}" Grid.Row="1"
                                Grid.RowSpan="2"/>
              <Grid x:Name="PART_Header" Row="1">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
              </Grid>
            </Grid>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Setter Property="FrameworkElement.Height" Value="{Binding PaneViewModel.Height, Mode=TwoWay}"/>
    </Style>
    <Style x:Key="PerfStatsStyle" TargetType="{x:Type TextBlock}">
      <Setter Property="TextBlock.FontSize" Value="20"/>
      <Setter Property="FrameworkElement.Margin" Value="0"/>
      <Setter Property="TextBlock.FontWeight" Value="Bold"/>
      <Setter Property="TextBlock.Foreground" Value="#BBFC9C29"/>
      <Setter Property="TextBlock.FontFamily" Value="Consolas"/>
    </Style>
    <s:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    <s:UltrachartOverviewVisibilityConverter x:Key="UltrachartOverviewVisibilityConverter"/>
  </FrameworkElement.Resources>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <s:SciChartGroup x:Name="ChartGroupEx" ItemContainerStyle="{StaticResource Grpstyle}"
                                                                             ItemsSource="{Binding ChartPaneViewModels}">
      <ItemsControl.ItemTemplate>
        <DataTemplate DataType="local:UltrachartPaneViewModel">
          <Grid>
            <li11l:BarManager.DXContextMenu>
              <s:chartmenu DataContext="{Binding ParentViewModel}"
                                                                          Area="{Binding DataContext.Area, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Grid}}}"/>
            </li11l:BarManager.DXContextMenu>
            <s:SciChartSurface Initialized="dje_zZBGLMJSS5D7A5HB5JY6ZP4E8JMHA_ejd" ClipModifierSurface="True"
                                                                                            s:SciChartGroup.VerticalChartGroup="{Binding PaneGroup}"
                                                                                            ChartModifier="{Binding ChartModifier}" ViewportManager="{Binding ViewportManager}">
              <s:SciChartSurface.Annotations>
                <Binding Mode="OneWay">                  <!-- constructor argument:
                       Annotations
                  -->

                </Binding>
              </s:SciChartSurface.Annotations>
              <s:SciChartSurface.SeriesSource>
                <Binding>                  <!-- constructor argument:
                       ChartSeriesViewModels
                  -->

                </Binding>
              </s:SciChartSurface.SeriesSource>
              <s:SciChartSurface.XAxes>
                <Binding>                  <!-- constructor argument:
                       XAxises
                  -->

                </Binding>
              </s:SciChartSurface.XAxes>
              <s:SciChartSurface.YAxes>
                <Binding>                  <!-- constructor argument:
                       YAxises
                  -->

                </Binding>
              </s:SciChartSurface.YAxes>
            </s:SciChartSurface>
            <s:ultrachartlegend Margin="23,23" DataContext="{Binding LegendViewModel}"
                                                                                                        Visibility="{Binding Pane.ShowLegend, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"/>
            <TextBlock Margin="0,20,70,0" VerticalAlignment="Top" HorizontalAlignment="Right"
                       Style="{StaticResource PerfStatsStyle}"
                       Visibility="{Binding ShowPerfStats, Converter={StaticResource BoolToVisibilityConverter}}"
                       Text="{Binding PerfStats}"/>
          </Grid>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </s:SciChartGroup>
    <s:UltrachartOverview Grid.Row="1" XAxisId="X" VerticalAlignment="Stretch" Height="40"
                                                                                    s:ItemsControlParentSurface.ItemsControlParentSurface="{Binding Path=., ElementName=ChartGroupEx}">
      <UIElement.Visibility>
        <MultiBinding Converter="{StaticResource UltrachartOverviewVisibilityConverter}">
          <Binding Path="ShowOverview"/>
          <Binding Path="ParentSurface" RelativeSource="{RelativeSource Self}"/>
        </MultiBinding>
      </UIElement.Visibility>
    </s:UltrachartOverview>
  </Grid>
</l1lil:Chart>