<local:BaseStudioControl x:Class="StockSharp.Studio.Controls.BuySellPanel"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:local="clr-namespace:StockSharp.Studio.Controls"
                         xmlns:sx="http://schemas.stocksharp.com/xaml"
                         xmlns:converters="clr-namespace:Ecng.Xaml.Converters;assembly=StockSharp.Xaml"
                         xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
                         xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
                         xmlns:xaml1="clr-namespace:Ecng.Xaml;assembly=StockSharp.Xaml"
                         DataContext="{Binding RelativeSource={RelativeSource Self}}">
  <FrameworkElement.Resources>
    <Storyboard x:Key="FlashErrorIcon">
      <ObjectAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetProperty="(UIElement.Visibility)">
        <DiscreteObjectKeyFrame KeyTime="00:00:00.0" Value="{x:Static Visibility.Visible}"/>
        <DiscreteObjectKeyFrame KeyTime="00:00:00.4" Value="{x:Static Visibility.Hidden}"/>
        <DiscreteObjectKeyFrame KeyTime="00:00:00.8" Value="{x:Static Visibility.Visible}"/>
        <DiscreteObjectKeyFrame KeyTime="00:00:01.2" Value="{x:Static Visibility.Hidden}"/>
        <DiscreteObjectKeyFrame KeyTime="00:00:01.6" Value="{x:Static Visibility.Visible}"/>
      </ObjectAnimationUsingKeyFrames>
    </Storyboard>
    <Style x:Key="ErrorTextBoxTemplate" TargetType="{x:Type Control}">
      <Setter Property="Validation.ErrorTemplate">
        <Setter.Value>
          <ControlTemplate>
            <Grid>
              <Ellipse Width="13" Height="13" Margin="4,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left"
                       StrokeThickness="1" Fill="Red"
                       ToolTip="{Binding ElementName=myControl, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}">
                <FrameworkElement.Triggers>
                  <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                    <BeginStoryboard Storyboard="{StaticResource FlashErrorIcon}"/>
                  </EventTrigger>
                </FrameworkElement.Triggers>
              </Ellipse>
              <TextBlock Foreground="White" FontSize="8pt" Margin="9,-1,0,0" FontWeight="Bold" Text="!"
                         VerticalAlignment="Center" HorizontalAlignment="Left"
                         ToolTip="{Binding ElementName=myControl, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}">
                <FrameworkElement.Triggers>
                  <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                    <BeginStoryboard Storyboard="{StaticResource FlashErrorIcon}"/>
                  </EventTrigger>
                </FrameworkElement.Triggers>
              </TextBlock>
              <Border BorderBrush="Red" BorderThickness="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <AdornedElementPlaceholder Name="myControl"/>
              </Border>
            </Grid>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
  </FrameworkElement.Resources>
  <Grid HorizontalAlignment="Stretch">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <Grid Row="0" ColumnSpan="4">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="2"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>
      <dx:SimpleButton x:Name="SettingsButton" ButtonKind="Toggle" Grid.Column="2">
        <Image Width="16" Height="16" Source="{sx:ThemedIcons Key=Settings}"/>
      </dx:SimpleButton>
      <xaml1:NonTopmostPopup x:Name="SettingsPopup" Grid.Column="2" Placement="Bottom" NoActivate="False" PopupAnimation="Fade"
                             Width="270" AllowsTransparency="True" PlacementTarget="{Binding ElementName=SettingsButton}"
                             IsOpen="{Binding ElementName=SettingsButton, Path=IsChecked, Mode=TwoWay}">
        <dx:BackgroundPanel x:Name="SettingsPanel">
          <sx:PropertyGridEx x:Name="SettingsPropertyGrid" ShowCategories="Hidden" ShowDescriptionIn="ToolTip"
                             HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
        </dx:BackgroundPanel>
      </xaml1:NonTopmostPopup>
      <dx:SimpleButton Click="CancelAll_Click" x:Name="CancelAll" Grid.Column="0"
                       ToolTip="{sx:Localization CancelAllOrders}" Content="{sx:Localization CancelAllOrders}"
                       Visibility="{Binding ElementName=SettingsPropertyGrid, Path=SelectedObject.ShowCancelAll, Converter={StaticResource BoolToVisibilityConverter}}"/>
    </Grid>
    <GroupBox Grid.Row="1" Grid.Column="0" Header="{sx:Localization LimitOrders}"
              Visibility="{Binding ElementName=SettingsPropertyGrid, Path=SelectedObject.ShowLimitOrderPanel, Converter={StaticResource BoolToVisibilityConverter}}">
      <Grid Height="24">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="2"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="2"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <dx:SimpleButton Click="BuyAtLimit_Click" Grid.Column="0" ToolTip="{sx:Localization Buy}"
                         Glyph="{sx:ThemedIcons Key=ShoppingCartAdd}"/>
        <dxe:SpinEdit Grid.Column="2" IsFloatValue="True" HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center" Style="{StaticResource ErrorTextBoxTemplate}" MinValue="0"
                      ToolTip="{sx:Localization OrderPrice}"
                      Increment="{Binding Settings.Security.PriceStep, FallbackValue=1}">
          <dxe:SpinEdit.Value>
            <Binding Path="Settings.LimitPrice" Mode="TwoWay" NotifyOnValidationError="True">
              <Binding.ValidationRules>
                <local:PriceValidationRule/>
              </Binding.ValidationRules>
            </Binding>
          </dxe:SpinEdit.Value>
        </dxe:SpinEdit>
        <dx:SimpleButton Click="SellAtLimit_Click" Grid.Column="4" ToolTip="{sx:Localization Sell}"
                         Glyph="{sx:ThemedIcons Key=ShoppingCartDelete}"/>
      </Grid>
    </GroupBox>
    <GroupBox Grid.Row="2" Grid.Column="0" Header="{sx:Localization MarketOrders}"
              Visibility="{Binding ElementName=SettingsPropertyGrid, Path=SelectedObject.ShowMarketOrderPanel, Converter={StaticResource BoolToVisibilityConverter}}">
      <Grid Height="24">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*" MinWidth="2"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="2"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*" MinWidth="2"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <dx:SimpleButton Click="BuyAtMarket_Click" x:Name="BuyAtMarket" Grid.Column="0"
                         ToolTip="{sx:Localization BuyByMarket}" Glyph="{sx:ThemedIcons Key=ShoppingCartAdd}"/>
        <dx:SimpleButton Click="ClosePosition_Click" x:Name="ClosePosition" Grid.Column="2"
                         ToolTip="{sx:Localization ClosePosition}" Glyph="{sx:ThemedIcons Key=Remove2}"/>
        <dx:SimpleButton Click="RevertPosition_Click" x:Name="RevertPosition" Grid.Column="4"
                         ToolTip="{sx:Localization RevertPosition}" Glyph="{sx:ThemedIcons Key=Refresh}"/>
        <dx:SimpleButton Click="SellAtMarket_Click" x:Name="SellAtMarket" Grid.Column="6"
                         ToolTip="{sx:Localization SellByMarket}" Glyph="{sx:ThemedIcons Key=ShoppingCartDelete}"/>
      </Grid>
    </GroupBox>
  </Grid>
</local:BaseStudioControl>