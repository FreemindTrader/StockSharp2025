<local:BaseStudioControl x:Class="StockSharp.Studio.Controls.MarketDataPanel"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                         xmlns:loc="clr-namespace:StockSharp.Localization;assembly=StockSharp.Localization"
                         xmlns:xaml="http://schemas.stocksharp.com/xaml"
                         xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
                         xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
                         xmlns:xaml1="clr-namespace:Ecng.Xaml;assembly=StockSharp.Xaml"
                         xmlns:local="clr-namespace:StockSharp.Studio.Controls"
                         xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
                         DataContext="{Binding RelativeSource={RelativeSource Self}}">
  <UIElement.CommandBindings>
    <CommandBinding Executed="ExecutedSelectSecurity" CanExecute="CanExecuteSelectSecurity"
                    Command="{x:Static local:MarketDataPanel.SelectSecurityCommand}"/>
    <CommandBinding Executed="ExecutedUnselectSecurity" CanExecute="CanExecuteUnselectSecurity"
                    Command="{x:Static local:MarketDataPanel.UnselectSecurityCommand}"/>
    <CommandBinding Executed="ExecutedDownload" CanExecute="CanExecuteDownload"
                    Command="{x:Static local:MarketDataPanel.DownloadCommand}"/>
    <CommandBinding Executed="ExecutedCancel" CanExecute="CanExecuteCancel"
                    Command="{x:Static local:MarketDataPanel.CancelCommand}"/>
    <CommandBinding Executed="EditSecurityCommandExecuted" CanExecute="EditSecurityCommandCanExecute"
                    Command="{x:Static local:MarketDataPanel.EditSecurityCommand}"/>
    <CommandBinding Executed="DeleteSecurityCommandExecuted" CanExecute="DeleteSecurityCommandCanExecute"
                    Command="{x:Static local:MarketDataPanel.DeleteSecurityCommand}"/>
  </UIElement.CommandBindings>
  <FrameworkElement.Resources>
    <xaml:SeriesToStringConverter x:Key="SeriesToStringConverter"/>
    <Style TargetType="{x:Type dx:LoadingDecorator}">
      <Style.Triggers>
        <MultiTrigger>
          <MultiTrigger.Conditions>
            <Condition Property="dx:LoadingDecorator.OwnerLock" Value="LoadingContent"/>
            <Condition Property="dx:LoadingDecorator.IsSplashScreenShown" Value="True"/>
          </MultiTrigger.Conditions>
          <Setter Property="UIElement.Opacity" Value=".5"/>
        </MultiTrigger>
      </Style.Triggers>
    </Style>
  </FrameworkElement.Resources>
  <xaml1:BusyIndicator x:Name="BusyIndicator" IsBusy="False">
    <xaml1:BusyIndicator.BusyContentTemplate>
      <DataTemplate>
        <StackPanel Margin="4" Width="250">
          <TextBlock Foreground="Black" HorizontalAlignment="Center" Text="{Binding Title}"/>
                    <dxe:ProgressBarEdit Margin="4" Height="20" IsPercent="True" DisplayFormatString="{}{0:p0}" ContentDisplayMode="Value"
                               Minimum="{Binding Minimum}" Maximum="{Binding Maximum}" EditValue="{Binding Value}"
                               StyleSettings="{Binding Settings}"/>
          <dx:SimpleButton Content="{x:Static loc:LocalizedStrings.Cancel}"
                           Command="{x:Static local:MarketDataPanel.CancelCommand}" HorizontalAlignment="Center"/>
        </StackPanel>
      </DataTemplate>
    </xaml1:BusyIndicator.BusyContentTemplate>
    <Grid Margin="5">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="5"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>
      <Grid SizeChanged="Grid_OnSizeChanged" Column="0">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="5"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="5"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="5"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="5"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="5"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="5"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <dx:SimpleButton Click="DownloadSecurities_OnClick" x:Name="DownloadSecurities"
                         ToolTip="{x:Static loc:LocalizedStrings.DownloadSecurities}" Grid.Row="0" Grid.Column="0">
          <Image Width="16" Source="{xaml:ThemedIcons Key=Download}"/>
        </dx:SimpleButton>
        <dx:DropDownButton Grid.Row="0" Grid.Column="2" Focusable="False" ToolTip="{x:Static loc:LocalizedStrings.Str2921}"
                           HorizontalAlignment="Left">
          <ContentControl.Content>
            <Image Width="16" Source="{xaml:ThemedIcons Key=Add}"/>
          </ContentControl.Content>
          <StackPanel>
            <dx:SimpleButton Click="CreateRegular" HorizontalContentAlignment="Left">
              <TextBlock Text="{x:Static loc:LocalizedStrings.Security}"/>
            </dx:SimpleButton>
            <dx:SimpleButton Click="CreateIndex" HorizontalContentAlignment="Left">
              <TextBlock Text="{x:Static loc:LocalizedStrings.Index}"/>
            </dx:SimpleButton>
            <dx:SimpleButton Click="CreateContinuous" HorizontalContentAlignment="Left">
              <TextBlock Text="{x:Static loc:LocalizedStrings.ContinuousSecurity}"/>
            </dx:SimpleButton>
          </StackPanel>
        </dx:DropDownButton>
        <dx:SimpleButton Grid.Row="0" Grid.Column="4" VerticalAlignment="Center" Focusable="False"
                         ToolTip="{x:Static loc:LocalizedStrings.Str2922}"
                         Command="{x:Static local:MarketDataPanel.EditSecurityCommand}">
          <Image Width="16" Source="{xaml:ThemedIcons Key=Edit}"/>
        </dx:SimpleButton>
        <dx:SimpleButton Grid.Row="0" Grid.Column="6" VerticalAlignment="Center" Focusable="False"
                         ToolTip="{x:Static loc:LocalizedStrings.XamlStr789}"
                         Command="{x:Static local:MarketDataPanel.DeleteSecurityCommand}">
          <Image Width="16" Source="{xaml:ThemedIcons Key=Remove2}"/>
        </dx:SimpleButton>
        <dx:SimpleButton Click="ExtendedInfo_OnClick" x:Name="ExtendedInfo" Grid.Row="0" Grid.Column="8" Focusable="False"
                         Content="{x:Static loc:LocalizedStrings.ExtendedInfo}"/>
        <dx:SimpleButton Click="SecurityMappings_OnClick" x:Name="SecurityMappings" Grid.Row="0" Grid.Column="10"
                         HorizontalAlignment="Left" Focusable="False" Content="{x:Static loc:LocalizedStrings.CodesMapping}"/>
        <Grid SizeChanged="Grid_OnSizeChanged" Row="2" Column="0" ColumnSpan="11">
          <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="30"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="30"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="30"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <xaml:SecurityPicker SecuritySelected="SecurityPicker_OnSecuritySelected" x:Name="SecuritiesAll"
                               Title="{x:Static loc:LocalizedStrings.Str2835}" Grid.Row="0" Grid.Column="0" Grid.RowSpan="5"
                               SelectionMode="Row"/>
          <Button Content="" Grid.Row="1" Grid.Column="2" FontFamily="Wingdings" FontSize="12" Padding="0"
                  Command="{x:Static local:MarketDataPanel.SelectSecurityCommand}"/>
          <Button Content="" Grid.Row="3" Grid.Column="2" FontFamily="Wingdings" FontSize="12" Padding="0"
                  Command="{x:Static local:MarketDataPanel.UnselectSecurityCommand}"/>
          <xaml:SecurityPicker SecuritySelected="SecurityPicker_OnSecuritySelected" x:Name="SecuritiesSelected"
                               Title="{x:Static loc:LocalizedStrings.XamlStr23}" Grid.Row="0" Grid.Column="4" Grid.RowSpan="5"
                               SelectionMode="Row"/>
        </Grid>
      </Grid>
      <GridSplitter Grid.Column="1" ResizeBehavior="PreviousAndNext"/>
      <xaml1:BusyIndicator x:Name="BusyIndicator1" Grid.Column="2">
        <xaml1:BusyIndicator.BusyContentTemplate>
          <DataTemplate>
            <StackPanel Margin="4" Width="250">
              <TextBlock Foreground="Black" Text="{x:Static loc:LocalizedStrings.XamlStr189}" HorizontalAlignment="Center"/>
              <dxe:ProgressBarEdit Margin="4" Height="20" ContentDisplayMode="None">
                <dxe:ProgressBarEdit.StyleSettings>
                  <dxe:ProgressBarMarqueeStyleSettings/>
                </dxe:ProgressBarEdit.StyleSettings>
              </dxe:ProgressBarEdit>
            </StackPanel>
          </DataTemplate>
        </xaml1:BusyIndicator.BusyContentTemplate>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
          </Grid.RowDefinitions>
          <Grid Row="0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="5"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="5"/>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="5"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" VerticalAlignment="Center">
              <Run Text="{x:Static loc:LocalizedStrings.Str1405}"/>
              <Run Text=":"/>
            </TextBlock>
            <xaml:DriveComboBox EditValueChanged="DriveCtrl_OnEditValueChanged" Changed="DriveCtrl_OnChanged" x:Name="DriveCtrl"
                                Grid.Column="2"/>
            <TextBlock Grid.Column="4" VerticalAlignment="Center">
              <Run Text="{x:Static loc:LocalizedStrings.Str2239}"/>
              :
            </TextBlock>
            <xaml:StorageFormatComboBox EditValueChanged="FormatCtrl_OnEditValueChanged" x:Name="FormatCtrl" Grid.Column="6" Width="80"/>
          </Grid>
          <GroupBox Header="{x:Static loc:LocalizedStrings.XamlStr655}" Grid.Row="1">
            <Grid>
              <WrapPanel Orientation="Horizontal">
                <TextBlock Margin="5,0,1,0" VerticalAlignment="Center">
                  <Run Text="{x:Static loc:LocalizedStrings.Str343}"/>
                  :
                </TextBlock>
                <dxe:DateEdit x:Name="DateTimeFrom" Width="110" Mask="d" AllowNullInput="False"/>
                <TextBlock Margin="5,0,1,0" VerticalAlignment="Center">
                  <Run Text="{x:Static loc:LocalizedStrings.Str345}"/>
                  :
                </TextBlock>
                <dxe:DateEdit x:Name="DateTimeTo" Width="110" Mask="d" AllowNullInput="False"/>
                <TextBlock Margin="5,0,1,0" VerticalAlignment="Center">
                  <Run Text="{x:Static loc:LocalizedStrings.TimeOutSecond}"/>
                  :
                </TextBlock>
                <dxe:SpinEdit x:Name="TimeoutSeconds" Width="50" MinValue="5" MaxValue="36000" AllowNullInput="False"
                              IsFloatValue="False" Increment="10" AllowSpinOnMouseWheel="True"/>
                <CheckBox x:Name="Ticks" Content="{x:Static loc:LocalizedStrings.Ticks}" Height="23" Margin="5,0,0,0"
                          MinHeight="25" Style="{StaticResource CheckBoxStyle}" VerticalContentAlignment="Center"/>
                <dx:SimpleButton Click="Candles_OnClick" MouseEnter="Candles_OnMouseEnter" x:Name="Candles"
                                 Content="{x:Static loc:LocalizedStrings.Candles}" Height="23" Margin="5,0,0,0" MinHeight="25"
                                 Style="{StaticResource CandleStyle}" VerticalAlignment="Center"/>
                <dx:SimpleButton Width="80" Margin="5,0,0,0" Content="{x:Static loc:LocalizedStrings.Str2421}"
                                 Command="{x:Static local:MarketDataPanel.DownloadCommand}"/>
              </WrapPanel>
              <Popup Name="TimeFramesPopup" StaysOpen="False" PopupAnimation="Scroll" AllowsTransparency="True"
                     PlacementTarget="{Binding ElementName=Candles}">
                <Border BorderBrush="Black" BorderThickness="2" Background="White">
                  <ListBox Name="TimeFrames" BorderThickness="0" Margin="5">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="2">
                          <local:CandleSeriesCheckBox VerticalAlignment="Center" Style="{StaticResource CheckBoxStyle}" IsChecked="{Binding IsSelected}"
                                                      Series="{Binding Value}"/>
                          <TextBlock VerticalAlignment="Center" Margin="5,0,0,0"
                                     Text="{Binding Value, Converter={StaticResource SeriesToStringConverter}}"/>
                        </StackPanel>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ListBox>
                </Border>
              </Popup>
            </Grid>
          </GroupBox>
          <xaml:MarketDataGrid x:Name="MarketDataGrid" Margin="2" Grid.Row="2"/>
        </Grid>
      </xaml1:BusyIndicator>
    </Grid>
  </xaml1:BusyIndicator>
</local:BaseStudioControl>