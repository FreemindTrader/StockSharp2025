<UserControl
    x:Class="fx.Charting.ChartPanelEx"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:dxprg="http://schemas.devexpress.com/winfx/2008/xaml/propertygrid"
    xmlns:loc="clr-namespace:StockSharp.Localization;assembly=StockSharp.Localization"
    xmlns:local="clr-namespace:fx.Charting"
    
    xmlns:sxpg="clr-namespace:StockSharp.Xaml.PropertyGrid;assembly=StockSharp.Xaml"
    
    xmlns:cnvt="clr-namespace:Ecng.Xaml.Converters;assembly=StockSharp.Xaml" xmlns:sxDev="clr-namespace:Ecng.Xaml;assembly=StockSharp.Xaml" xmlns:dxes="http://schemas.devexpress.com/winfx/2008/xaml/editors" 
    x:Name="Ctrl"
    dxb:BarNameScope.IsScopeOwner="true">

    <UIElement.CommandBindings>
        <CommandBinding
            CanExecute="CanExecuteRegisterOrderCommand"
            Command="{x:Static local:ChartPanelEx.RegisterOrderCommand}"
            Executed="ExecuteRegisterOrderCommand" />
        <CommandBinding
            CanExecute="CanExecuteAddAreaCommand"
            Command="{x:Static local:ChartPanelEx.AddAreaCommand}"
            Executed="ExecuteAddAreaCommand" />
    </UIElement.CommandBindings>

    <FrameworkElement.Resources>
        <Style x:Key="ImgStyle" TargetType="{x:Type Image}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}, AncestorLevel=1}, Path=IsEnabled}" Value="False">
                    <Setter Property="UIElement.Opacity" Value="0.3" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <cnvt:EnumBooleanConverter x:Key="EnumBooleanConverter" DefaultValueWhenUnchecked="true" />
    </FrameworkElement.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <dxb:BarManager
            x:Name="BarManager"
            Grid.Column="0"
            AllowGlyphTheming="true">
            <dxb:BarManager.Bars>
                <dxb:Bar>
                    <dxb:Bar.DockInfo>
                        <dxb:BarDockInfo ContainerType="Left" />
                    </dxb:Bar.DockInfo>
                    <dxb:BarButtonItem
                        Command="{x:Static local:ChartPanelEx.AddAreaCommand}"
                        CommandTarget="{Binding ElementName=Ctrl, Mode=OneWay}"
                        Glyph="{dx:DXImage SvgImages/Dashboards/AddQuery.svg}"
                        ToolTip="{x:Static loc:LocalizedStrings.Area}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarEditItem
                        x:Name="CandleStyles"
                        EditValueChanged="CandleStyles_EditValueChanged"
                        EditWidth="120">
                        <dxb:BarEditItem.EditSettings>
                            <dxes:ComboBoxEditSettings
                                x:Name="CandleStylesSettings"
                                ApplyItemTemplateToSelectedItem="true"
                                IsTextEditable="False">
                                <dxes:LookUpEditSettingsBase.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="Transparent">
                                            <StackPanel Orientation="Horizontal">
                                                <Image
                                                    Width="16"
                                                    Height="16"
                                                    Source="{sxDev:ThemedIconBinding Path=Image}" />
                                                <TextBlock
                                                    Margin="5,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Text="{Binding Path=Name}" />
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </dxes:LookUpEditSettingsBase.ItemTemplate>
                            </dxes:ComboBoxEditSettings>
                        </dxb:BarEditItem.EditSettings>
                    </dxb:BarEditItem>
                    <dxb:BarItemSeparator />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Arrows/Last.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=IsAutoScroll}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.Settings}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Dashboards/GridColumnFixedWidth.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=AutoRangeByAnnotations}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.AutoRange}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Dashboards/AlignmentTopLeft.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=ShowLegend}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.AutoAlign}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Reports/GroupFooter.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=ShowOverview}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.OverviewArea}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/RichEdit/BordersInside.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=CrossHair}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.ShowCross}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Icon Builder/Actions_Comment.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=CrossHairTooltip}"
                        IsEnabled="{Binding ElementName=Chart, Path=CrossHair}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.ShowTooltip}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Spreadsheet/ChartAxesGroup.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=CrossHairAxisLabels}"
                        IsEnabled="{Binding ElementName=Chart, Path=CrossHair}"
                        ItemClick="OnSettingsClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.AxisLabels}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarItemSeparator />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Icon Builder/Business_LinearChart.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=LineAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Line}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Dashboards/TreemapBottomLeftTopRightDirection.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=LineArrowAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Line}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=VerticalLineAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Line}"
                        ToolTipService.ShowOnDisabled="true">
                        <dxb:BarItem.GlyphTemplate>
                            <DataTemplate>
                                <Image Source="{dx:DXImage SvgImages/Icon Builder/Business_LinearChart.svg}">
                                    <UIElement.RenderTransform>
                                        <RotateTransform Angle="-45" CenterX="7" CenterY="7" />
                                    </UIElement.RenderTransform>
                                </Image>
                            </DataTemplate>
                        </dxb:BarItem.GlyphTemplate>
                    </dxb:BarCheckItem>
                    <dxb:BarCheckItem
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=HorizontalLineAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Line}"
                        ToolTipService.ShowOnDisabled="true">
                        <dxb:BarItem.GlyphTemplate>
                            <DataTemplate>
                                <Image Source="{dx:DXImage SvgImages/Icon Builder/Business_LinearChart.svg}">
                                    <UIElement.RenderTransform>
                                        <RotateTransform Angle="45" CenterX="7" CenterY="7" />
                                    </UIElement.RenderTransform>
                                </Image>
                            </DataTemplate>
                        </dxb:BarItem.GlyphTemplate>
                    </dxb:BarCheckItem>
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/DiagramIcons/Figures/figures1.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=BoxAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Area}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Dashboards/EditNames.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=TextAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Text}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Dashboards/EditNames.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=AnnotationType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=RulerAnnotation}"
                        ToolTip="{x:Static loc:LocalizedStrings.Ruler}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarCheckItem
                        Glyph="{dx:DXImage SvgImages/Dashboards/Gauges.svg}"
                        IsChecked="{Binding ElementName=Chart, Path=ShowPerfStats}"
                        ToolTip="{x:Static loc:LocalizedStrings.ShowFPS}"
                        ToolTipService.ShowOnDisabled="true" />
                    <dxb:BarItemSeparator />
                    <dxb:BarSplitButtonItem
                        Command="{x:Static local:ChartPanelEx.RegisterOrderCommand}"
                        CommandTarget="{Binding ElementName=Ctrl, Mode=OneWay}"
                        DataContext="{Binding ElementName=Chart}"
                        ItemClick="RegisterOrderCommandItemClick"
                        ToolTipService.ShowOnDisabled="true">
                        <dxb:BarItem.SuperTip>
                            <dx:SuperTip>
                                <dx:SuperTipHeaderItem Content="{x:Static loc:LocalizedStrings.OrderRegistering}" />
                                <dx:SuperTipItem Content="{x:Static loc:LocalizedStrings.OrderRegistering}" />
                                <dx:SuperTipItem Content="{x:Static loc:LocalizedStrings.OrderRegistering}" />
                            </dx:SuperTip>
                        </dxb:BarItem.SuperTip>
                        <dxb:BarItem.GlyphTemplate>
                            <DataTemplate>
                                <ToggleButton
                                    Margin="-2"
                                    IsChecked="{Binding Path=OrderCreationMode}"
                                    Style="{StaticResource {x:Static ToolBar.ToggleButtonStyleKey}}">
                                    <Image Source="{dx:DXImage SvgImages/Icon Builder/Electronics_Mouse.svg}" Style="{StaticResource ImgStyle}" />
                                </ToggleButton>
                            </DataTemplate>
                        </dxb:BarItem.GlyphTemplate>
                        <dxb:BarSplitButtonItem.PopupControl>
                            <dxb:PopupControlContainer>
                                <sxpg:PropertyGridEx x:Name="OrderSettingsPropertyGrid" Width="270" MinHeight="140"/>
                            </dxb:PopupControlContainer>
                        </dxb:BarSplitButtonItem.PopupControl>
                    </dxb:BarSplitButtonItem>
                    <dxb:BarButtonItem
                        Glyph="{dx:DXImage SvgImages/Outlook Inspired/SaveAs.svg}"
                        ItemClick="SaveButtonClicked"
                        ToolTip="{x:Static loc:LocalizedStrings.Save}" />
                    <dxb:BarSplitButtonItem
                        x:Name="ShareButton"
                        Glyph="{dx:DXImage SvgImages/Icon Builder/Actions_Image.svg}"
                        IsEnabled="false"
                        ToolTip="{x:Static loc:LocalizedStrings.ShareImage}">
                        <dxb:BarSplitButtonItem.PopupControl>
                            <dxb:PopupControlContainer>
                                <sxpg:PropertyGridEx
                                    x:Name="ShareSettingsPropertyGrid"
                                    Width="270"
                                    MinHeight="140"
                                    dxprg:PropertyGridControl.ShowCategories="Hidden"
                                    dxprg:PropertyGridControl.ShowDescriptionIn="ToolTip"
                                    dxprg:PropertyGridControl.ShowMenuButtonInRows="false"
                                    dxprg:PropertyGridControl.ShowSearchBox="false"
                                    dxprg:PropertyGridControl.ShowToolPanel="false" />
                            </dxb:PopupControlContainer>
                        </dxb:BarSplitButtonItem.PopupControl>
                    </dxb:BarSplitButtonItem>
                </dxb:Bar>
            </dxb:BarManager.Bars>
        </dxb:BarManager>
        <local:Chart x:Name="Chart" Grid.Column="1" />
    </Grid>

</UserControl>